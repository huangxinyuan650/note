## 网络知识
### TCP、UDP
#### TCP介绍
- 优点：稳定、可靠（三次握手、数据传递时有确认、窗口、重传、拥塞控制机制）
- 缺点：慢、效率低，占用资源高、易被攻击

##### 重传机制
- 超时重传：设定超时阈值，当发送数据包丢失或确认应答丢失时都触发超时重传，超时时间加倍
- 快重传：当收到三个相同ack报文时会在定时器过期前触发快重传

#### UDP介绍
- 优点：快（无状态协议）、比TCP稍安全
- 缺点：不可靠、不稳定

#### TCP与UDP的区别
1、TCP面向连接（三次握手）、UDP是无连接
2、TCP提供可靠服务（无差错、不丢失、不重复、按需到达）、UDP尽力交付不保证可靠交付
3、TCP面向字节流（将数据看成一串无结构字节流）、UDP面向报文（无拥塞，不会因为网络问题而调整发包速率，适用视频通话等）
4、TCP连接为点对点、UDP连接可以为一对一、一对多、多对多
5、TCP首部开销20字节、UDP首部开销8字节
6、TCP通信信道为全双工可靠信道、UDP为不可靠信道

#### 使用UDP实现TCP
1、增加seq/ack机制从而确保数据发送成功
2、增加发送和接收缓冲区来支持超时重传
3、增加超时重传机制

### 流量控制（发送方发送速率不要太快）
#### 窗口滑动实现流量控制（接收到ack后移动窗口）
数据接收方告知发送方可接收数据窗口大小，发送方依次发送窗口大小的数据，
在数据传输的过程中数据接收方在接收到数据后会发送一个ack(接收到的数据的游标、调整窗口大小的新值)给发送方，
发送方在收到ack和新窗口（非必须）后移动窗口（有新窗口大小的需调整窗口大小）继续发送新的数据，同时删除缓冲区中已发送成功数据

### 拥塞控制
#### 慢启动
当窗口小于慢启动门限(ssthresh)，每收到一个ack窗口乘2（指数增长），当窗口大于慢启动门限时则使用拥塞避免算法（线性增长）
#### 拥塞避免
收到一个ack，窗口增加 1/窗口大小。当增长到一定值，出现拥塞导致丢包触发重传机制，使用拥塞发生算法
#### 拥塞发生
- 超时重传：慢启动门限(ssthresh)变为窗口大小/2，窗口大小变为1。（过分激进）
- 快重传：窗口大小变为原来的一半，慢启动门限(ssthresh)变为窗口大小
进入快速恢复
#### 快速恢复
窗口大小变为原窗口大小+3（3是确认有3个数据包收到了），重传丢失数据包，若收到重复的ack则将窗口大小加1，进入拥塞避免算法

### HTTP
基于请求响应的无状态应用层协议，基于TCP/IP协议传输数据
请求报文组成：起始行（方法、URI、版本）、请求头（属性：属性值，host是必须）、空行、实体（请求体）
响应报文组成：响应行（版本、状态码、原因短语），响应头（属性：属性值）、空行、实体（响应体）
#### 缓存说明（no-cache、no-store、must-revalidate）
- no-cache：可缓存，但使用前需向服务器判断是否过期
- no-store：不允许缓存
- must-revalidate：一旦资源过期，在成功向原始服务器验证前缓存不能用该资源请求后的请求
- if-Modified-Since：文件最后修改时间
- if-None-Match：对get、head请求，只有当服务器端没有任何匹配etag的资源时才返回请求

#### 三次握手、四次挥手
##### 三次握手
- 1、客户端发送syn包到服务端
- 2、服务端收到syn包后向客户端发送syn+ack包（此时服务端建立半连接）
- 3、客户端收到syn+ack包后向服务端发送ACK包ack+1（此时服务端建立全连接）
- 4、客户端开始向服务端发送报文（这步有时可以提前到第三步）
##### 四次挥手
- 1、主动关闭端向另一端发送fin报文
- 2、另一端收到fin报文后，向主动端发送ack确认报文，并开始将未发送的数据都发送出去
- 3、另一端在数据都发送完成后，向主动端发送fin报文
- 4、主动端收到fin报文后，向另一端发送ack报文确认

##### https
###### 对称加密和非对称加密
- 对称加密：加密密钥和解密密钥是同一个，客户端和服务端都通过同一个密钥加解密。（密钥传输困难）
- 非对称加码：公钥密钥和私钥密钥不同，客户端通过公钥加密要发送的数据和解密服务端的数据，服务端通过私钥解密客户端的数据和加密返回给客户端的数据。（但公钥容易获得，服务器回复的消息任何人都可以解密，所以客户端和服务端都需要一对公钥和私钥）
###### https工作模式
- 1、客户端访问https网站，当发现是https时，客户端会以明文传输TLS版本、加密套件候选列表、压缩算法候选列表、一个随机数（A）等信息
- 2、服务端会返回服务端使用的协议版本、加密套件、压缩算法、一个随机数（B）等信息
- 3、服务端还会向客户端发送自己的CA证书，然后再发一个消息发送完成的消息
- 4、客户端收到服务端的CA证书后会从自己信任的CA仓库中CA证书的公钥去解密服务端的CA证书，若解密成功则服务端的CA证书可信，服务端可信（这过程中若本地CA无法解密则会向CA的CA等一层层追溯去解密服务端的CA）
- 5、客户端验证完服务端的CA证书后，会生成一个Pre-master的随机数，然后发送client key exchange，用证书中的公钥加密，再发送给服务端，服务端可通过私钥解密
- 6、此时客户端和服务端都已经有随机数A、随机数B、随机数Pre-master，然后根据这三个随机数生成一个对称加密密钥
- 7、客户端向服务端发送change cipher spec确定之后通信的加密密钥和加密算法
- 8、客户端通过对称加密密钥发送encrypted handshake message消息用于数据和握手验证
- 9、服务端也向客户端发送change cipher spec消息确认之后通信的加密密钥和加密算法
- 10、服务端对称加密密钥也向客户端发送encrypted handshake message消息
- 11、至此客户端和服务端都将通过新生成的对称加密密钥来进行数据传输了

```
    # 创建私钥
    openssl genrsa -out private.key 1024
    # 创建公钥
    openssl rsa -in private.key -pubout -out public.pem 
    # 创建CA证书请求
    openssl req -key private.key -new -out ca.req 回车后会要求输入一系列信息
    # CA为服务端创建CA证书
    openssl x509 -req -in ca.req -CA ca.pem -CAkey ca.key -out server_ca.pem
```

##### http2.0
- 头部压缩：维护一份静态字典，当头部内容为字典条目时只传编号（哈夫曼编码）
- 二进制格式：头和body都为二进制
- 流：同一个消息往返为同一个唯一的ID，这样可区分消息，即可以不再受一来一回的限制

##### 一个域名绑定多个IP
查询一个域名绑定的IP，nslookup domain

- DNS：dig +trace domain

#### 其他
- Ping：ICMP协议，处于网络层，通过发送回送请求报文和回送回答报文
- traceroute domain：想目标地址发送udp报文，判断路径